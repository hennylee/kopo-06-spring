<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="card.CardDAO" >
	
	<select id="findById" parameterType="string" resultType="cardVO">
		select * from card where member_id = #{memberId} 
	</select>

	<select id="cardNoCheck" parameterType="string" resultType="int">
		select count(*) from card where card_no = #{cardNo}
	</select>
	
	<insert id="insertCard" parameterType="cardVO">
		insert into card(
		    card_no, cvc, family_name, given_name, member_id
		) values(
		    #{cardNo}
		    ,#{cvc}
		    ,#{familyName}
		    ,#{givenName}
		    ,#{memberId}
		)
	</insert>
	
	<insert id="insertRegister" parameterType="registerVO">
		insert into card_register(
		    no, zip, addr1, addr2, card_no, APPLICANT_ID
		) values(
			CARD_REGISTER_SEQ.nextval
		    , #{zip}
		    , #{addr1}
		    , #{addr2}
		    , #{cardNo}
		    , #{applicantId}
	    )
	</insert>
	
	
	<insert id="insertZeroBalance" parameterType="string" statementType="CALLABLE">
		{ call CARD_BALANCER_RESET_PROC( #{cardNo}) }
	</insert>
	
	<select id="cardBalanceById" parameterType="String" resultType="cardBalanceVO">
		select currency_code, balance, card_no, rownum as rank from (
		    select currency_code, balance, c.card_no 
		    from card_balance b, card c
		    where c.member_id = #{memberId}
		    and balance != 0
		    and trim(b.card_no) = trim(c.card_no)
		    order by balance desc)
	</select>
	
</mapper>