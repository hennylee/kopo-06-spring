<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="currency.CurrencyDAO" >
	
	<select id="nationAll" resultType="nationCodeVO">
		select * from nation_code
	</select>
	
	<select id="selectByNation" parameterType="String" resultType="exchangeRateVO">
		select * from exchange_rate where currency_en = #{currencyEn} order by reg_date
	</select>

	<select id="selectAllCurRate" resultType="exchangeRateVO">
		select * from exchange_rate 
		where reg_date = (select max(reg_date) from exchange_rate)
	</select>

	<select id="selectCurRate" parameterType="String" resultType="exchangeRateVO">
		select * from (select * from exchange_rate where currency_en = #{currencyEn} order by reg_date) where rownum = 1
	</select>
	
	<select id="selectAccounts" parameterType="String" resultType="openbankAccountVO">
		SELECT O.* FROM openbank_account O, CARD C
			WHERE C.MEMBER_ID = #{id}
			AND O.CARD_NO = C.CARD_NO
	</select>
	
	<update id="updateAccountBalance" parameterType="openbankAccountVO">
		update openbank_account set balance = balance - #{balance}
		where account_bank = #{accountBank}
		and account_num = #{accountNum}
	</update>
	
	<update id="updateCardBalance" parameterType="cardBalanceVO">
		update card_balance set balance = balance + #{balance}
		where card_no = #{cardNo}
		and currency_en = #{currencyEn}
	</update>
	
	<insert id="insertCharge" parameterType="chargeHistoryVO">
		INSERT INTO charge_history(
		    no, account_no,account_bank,
		    currency_en, kr_amount,card_no,exchange_rate,fe_amount
		) values(
		    charge_history_seq.nextval
		    , #{accountNo}
		    , #{accountBank}
		    , #{currencyEn}
		    , #{krAmount}
		    , #{cardNo}
		    , #{exchangeRate}
		    , #{feAmount}
		)
	</insert>
	
	<insert id="insertRefund" parameterType="refundHistoryVO">
		INSERT INTO refund_history(
		    no, account_no,account_bank,
		    currency_en, kr_amount,card_no,exchange_rate,fe_amount
		) values(
		    refund_history_seq.nextval
		    , #{accountNo}
		    , #{accountBank}
		    , #{currencyEn}
		    , #{krAmount}
		    , #{cardNo}
		    , #{exchangeRate}
		    , #{feAmount}
		)
	</insert>
	
	
	
</mapper>