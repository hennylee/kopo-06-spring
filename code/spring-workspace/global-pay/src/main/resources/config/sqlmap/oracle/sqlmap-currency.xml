<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="currency.CurrencyDAO" >

	<!-- 컬럼과 vo의 매핑코드 -->
	<resultMap type="kr.kro.globalpay.currency.vo.NationCodeVO" id="NationCodeMap">
		<result column="name_kr" property="nameKr"/>
		<result column="name_en" property="nameEn"/>
	</resultMap>
	
	<select id="selectAllHistory" parameterType="string" resultType="chargeHistoryVO">
		select * from charge_history where card_no = #{cardNo} 
	</select>
	
	<select id="nationAll" resultMap="NationCodeMap">
		select * from nation_code
	</select>
	
	<select id="selectByNation" parameterType="String" resultType="exchangeRateVO">
		select * from exchange_rate where nation_en = #{nation} order by reg_date
	</select>
	
	<select id="selectAccounts" parameterType="String" resultType="openbankAccountVO">
		SELECT O.* FROM openbank_account O, CARD C
			WHERE C.MEMBER_ID = #{id}
			AND O.CARD_NO = C.CARD_NO
	</select>
	
	<update id="updateAccountBalance" parameterType="openbankAccountVO">
		update openbank_account set balance = balance - #{balance}
		where account_bank = #{accountBank}
		and account_num = #{accountNum}
	</update>
	
	<update id="updateCardBalance" parameterType="cardBalanceVO">
		update card_balance set balance = balance + #{balance}
		where card_no = #{cardNo}
		and currency_code = #{currencyCode}
	</update>
	
	<insert id="insertCharge" parameterType="chargeHistoryVO">
		INSERT INTO charge_history(
		    no, account_no,account_bank,
		    currency_code, kr_amount,card_no,exchange_rate,fe_amount
		) values(
		    charge_history_seq.nextval
		    , #{accountNo}
		    , #{accountBank}
		    , #{currencyCode}
		    , #{krAmount}
		    , #{cardNo}
		    , #{exchangeRate}
		    , #{feAmount}
		)
	</insert>
	
	
</mapper>